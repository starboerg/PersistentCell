<?xml version='1.0' encoding='UTF-8'?>
<MorpheusModel version="4">
    <Description>
        <Details></Details>
        <Title>PRW self-reenforced</Title>
    </Description>
    <Space>
        <Lattice class="square">
            <Neighborhood>
                <Order>optimal</Order>
            </Neighborhood>
            <Size symbol="size" value="cell_spacing * array_size, cell_spacing * array_size , 0"/>
            <BoundaryConditions>
                <Condition type="periodic" boundary="x"/>
                <Condition type="periodic" boundary="y"/>
            </BoundaryConditions>
        </Lattice>
        <SpaceSymbol symbol="space"/>
    </Space>
    <Time>
        <StartTime value="0"/>
        <StopTime value="4000"/>
        <TimeSymbol symbol="time"/>
    </Time>
    <Analysis>
        <ModelGraph include-tags="#untagged" format="dot" reduced="false"/>
        <Gnuplotter time-step="100">
            <Plot>
                <Cells value="dir.phi"/>
                <CellArrows center="origin" orientation="dir*2 / l_n"/>
            </Plot>
            <Terminal name="png" size="1500,1500,0"/>
        </Gnuplotter>
        <Logger time-step="1.0">
            <Input>
                <Symbol symbol-ref="msd"/>
            </Input>
            <Output>
                <TextOutput/>
            </Output>
            <Plots>
                <Plot time-step="-1">
                    <Style style="points"/>
                    <Terminal terminal="png"/>
                    <X-axis logarithmic="true">
                        <Symbol symbol-ref="time"/>
                    </X-axis>
                    <Y-axis logarithmic="true">
                        <Symbol symbol-ref="msd"/>
                    </Y-axis>
                </Plot>
            </Plots>
        </Logger>
    </Analysis>
    <Global>
        <Constant symbol="cpm_time_scale" value="1"/>
        <Constant symbol="l_n" name="node length" value="0.2"/>
        <Constant symbol="r" name="cell radius" value="1"/>
        <Constant symbol="a" name="cell area" value="pi*r^2"/>
        <Constant symbol="λ_a" value="10"/>
        <Constant symbol="p" name="cell perimeter" value="2*pi*r">
            <Annotation>we assume an approximately circular shape</Annotation>
        </Constant>
        <Constant symbol="λ_p" value="5"/>
        <Constant symbol="xi_p" name="..." value="1">
            <Annotation>Correction factor for the estimation of surface length in the CPM. Depend on the neighborhood choice.
                In this model we make use normalization of interface / surface lengths, such that xi==1 </Annotation>
        </Constant>
        <Constant symbol="mu" name="cell motility strength" value="0.5"/>
        <Constant symbol="t_half_persist" name="persistence half life" value="1"/>
        <Constant symbol="mcs_d" name="MonteCarloStep duration" value="cpm_time_scale * l_n"/>
        <Constant symbol="array_size" value="8"/>
        <Constant symbol="cell_spacing" value="ceil(20*r/l_n)"/>
        <Variable symbol="msd" name="mean squared displacement" value="0.0"/>
    </Global>
    <CellTypes>
        <CellType name="cell" class="biological">
            <Constant symbol="a_cpm" name="area in nodes" value="a/l_n^2"/>
            <Constant symbol="λ_a_cpm" value="λ_a*l_n^4"/>
            <VolumeConstraint target="a_cpm" strength="λ_a_cpm"/>
            <Constant symbol="p_cpm" value="p / l_n*xi_p"/>
            <Constant symbol="λ_p_cpm" value="λ_p * (l_n/xi_p)^2"/>
            <SurfaceConstraint target="p_cpm" strength="λ_p_cpm" mode="surface"/>
            <Constant symbol="mu_cpm" value="mu * mcs_d * l_n"/>
            <DirectedMotion strength="mu_cpm" direction="dir"/>
            <Property symbol="α" value="rand_uni(0,2*pi)"/>
            <PropertyVector notation="r,φ,θ" symbol="dir" name="motility direction" value="1,α,0"/>
            <PropertyVector symbol="velocity" value="0.0, 0.0, 0.0"/>
            <MotilityReporter time-step="mcs_d">
                <Velocity symbol-ref="velocity"/>
                <Annotation>Reports velocity in nodes / simulation time </Annotation>
            </MotilityReporter>
            <System time-step="mcs_d" name="Motility vector adjustment" solver="Euler [fixed, O(1)]">
                <Constant symbol="k" name="reenforcement rate" value="-ln(0.5)/t_half_persist"/>
                <VectorRule symbol-ref="dir">
                    <Expression>(1-k*mcs_d) * dir + k*mcs_d * velocity</Expression>
                </VectorRule>
            </System>
            <PropertyVector symbol="cell.center.initial" value="cell.center">
                <Annotation>Rember the initial cell position for MSD calculation</Annotation>
            </PropertyVector>
            <Function symbol="sqr_displacement" name="squared displacement">
                <Expression>( (cell.center.x-cell.center.initial.x)^2 +(cell.center.y-cell.center.initial.y)^2 ) * l_n^2</Expression>
                <Annotation>Squared displacement calculation</Annotation>
            </Function>
            <Mapper name="mean ssquared displacement calculation">
                <Input value="sqr_displacement"/>
                <Output symbol-ref="msd" mapping="average"/>
            </Mapper>
        </CellType>
    </CellTypes>
    <CellPopulations>
        <Population type="cell" size="1">
            <InitCellObjects mode="distance">
                <Arrangement repetitions="array_size, array_size, 1" displacements="cell_spacing, cell_spacing, 1">
                    <Sphere center="cell_spacing/2, cell_spacing/2, 0" radius="r/l_n"/>
                </Arrangement>
            </InitCellObjects>
        </Population>
    </CellPopulations>
    <CPM>
        <Interaction/>
        <ShapeSurface scaling="norm">
            <Neighborhood>
                <Order>optimal</Order>
            </Neighborhood>
        </ShapeSurface>
        <MonteCarloSampler stepper="edgelist">
            <MCSDuration value="mcs_d"/>
            <MetropolisKinetics temperature="2 * l_n"/>
            <Neighborhood>
                <Order>optimal</Order>
            </Neighborhood>
        </MonteCarloSampler>
    </CPM>
</MorpheusModel>
