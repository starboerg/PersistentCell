<?xml version='1.0' encoding='UTF-8'?>
<MorpheusModel version="4">
    <Description>
        <Details></Details>
        <Title>PRW continuous</Title>
    </Description>
    <Space>
        <Lattice class="square">
            <Neighborhood>
                <Order>optimal</Order>
            </Neighborhood>
            <Size symbol="size" value="100,100,1"/>
            <BoundaryConditions>
                <Condition type="periodic" boundary="x"/>
                <Condition type="periodic" boundary="y"/>
            </BoundaryConditions>
        </Lattice>
        <SpaceSymbol symbol="space"/>
    </Space>
    <Time>
        <StartTime value="0"/>
        <StopTime value="10000"/>
        <TimeSymbol symbol="time"/>
    </Time>
    <Analysis>
        <ModelGraph include-tags="#untagged" format="dot" reduced="false"/>
        <Gnuplotter time-step="200">
            <Plot>
                <Cells value="dir.phi"/>
                <CellArrows orientation="dir*10" center="origin"/>
            </Plot>
            <Terminal name="png" size="1200,1200,0"/>
        </Gnuplotter>
        <Logger time-step="1.0">
            <Input>
                <Symbol symbol-ref="msd"/>
            </Input>
            <Output>
                <TextOutput/>
            </Output>
            <Plots>
                <Plot time-step="-1">
                    <Style style="points"/>
                    <Terminal terminal="png"/>
                    <X-axis logarithmic="true">
                        <Symbol symbol-ref="time"/>
                    </X-axis>
                    <Y-axis logarithmic="true">
                        <Symbol symbol-ref="msd"/>
                    </Y-axis>
                </Plot>
            </Plots>
        </Logger>
    </Analysis>
    <Global>
        <Constant symbol="cpm_time_scale" value="0.5"/>
        <Constant symbol="l_n" name="node length" value="0.2"/>
        <Constant symbol="d" name="cell radius" value="2"/>
        <Constant symbol="a" name="cell area" value="3.14">
            <Annotation>continuous space coords; unit sphere a=pi*d^2*0.25</Annotation>
        </Constant>
        <Constant symbol="λ_a" value="10"/>
        <Constant symbol="p" name="cell perimeter" value="6.28">
            <Annotation>we assume an approximately circular shape, p=pi*d</Annotation>
        </Constant>
        <Constant symbol="λ_p" value="5"/>
        <Constant symbol="xi_p" name="..." value="3">
            <Annotation>Correction factor for the estimation of surface length in the CPM.
Depends on the neighborhood choice. 

Here we choose a 2nd order neighborhood for interface / surface lengths, such that xi=´3</Annotation>
        </Constant>
        <Constant symbol="mu" name="cell motility strength" value="0.5"/>
        <Constant symbol="ω" name="angular noise amplitude" value="0.2"/>
        <Constant symbol="mcs_d" name="MonteCarloStep duration" value="0.1">
            <Annotation>Duration of a MonteCarloStep
mcs_d = cpm_time_scale * l_n</Annotation>
        </Constant>
        <Constant symbol="array_size" value="1">
            <Annotation>Population array size</Annotation>
        </Constant>
        <Constant symbol="spacing" value="2"/>
        <Constant symbol="cell_spacing" value="ceil(spacing*d/l_n)">
            <Annotation>cell spacing in nodes: 
cell_spacing = ceil(spacing*d/l_n)
</Annotation>
        </Constant>
        <Variable symbol="msd" name="mean squared displacement" value="0.0"/>
        <Constant symbol="reenf_rate" value="0.0"/>
    </Global>
    <CellTypes>
        <CellType class="biological" name="cell">
            <Constant symbol="a_cpm" name="area in nodes" value="78.5">
                <Annotation>a/l_n^2</Annotation>
            </Constant>
            <Constant symbol="λ_a_cpm" value="0.016">
                <Annotation>λ_a*l_n^4</Annotation>
            </Constant>
            <VolumeConstraint target="78.5" strength="0.016"/>
            <Constant symbol="p_cpm" value="94.2">
                <Annotation>p / l_n * xi_p</Annotation>
            </Constant>
            <Constant symbol="λ_p_cpm" value="0.0222">
                <Annotation>λ_p * (l_n/xi_p)^2</Annotation>
            </Constant>
            <SurfaceConstraint mode="surface" target="94.2" strength="0.0222"/>
            <Constant symbol="mu_cpm" value="0.01">
                <Annotation>mu * mcs_d * l_n</Annotation>
            </Constant>
            <DirectedMotion strength="0.01" direction="dir"/>
            <Property symbol="α" value="rand_uni(0,2*pi)"/>
            <PropertyVector symbol="dir" notation="r,φ,θ" value="1,α,0"/>
            <System solver="Euler [fixed, O(1)]" time-step="mcs_d">
                <DiffEqn name="orientation" symbol-ref="α">
                    <Expression>rand_norm(0,ω / sqrt(mcs_d))</Expression>
                </DiffEqn>
                <VectorRule symbol-ref="dir" notation="r,φ,θ">
                    <Expression>1, α, 0.0</Expression>
                </VectorRule>
            </System>
            <PropertyVector symbol="cell.center.initial" value="cell.center"/>
            <Function symbol="sqr_displacement" name="squared displacement calculation">
                <Expression>( (cell.center.x-cell.center.initial.x)^2 +(cell.center.y-cell.center.initial.y)^2 ) * l_n^2</Expression>
            </Function>
            <Mapper name="mean ssquared displacement calculation">
                <Input value="sqr_displacement"/>
                <Output symbol-ref="msd" mapping="average"/>
            </Mapper>
            <MotilityReporter time-step="mcs_d">
                <Velocity symbol-ref="velocity"/>
            </MotilityReporter>
            <PropertyVector symbol="velocity" value="0.0, 0.0, 0.0"/>
        </CellType>
    </CellTypes>
    <CellPopulations>
        <Population size="1" type="cell">
            <InitCellObjects mode="distance">
                <Arrangement repetitions="array_size, array_size, 1" displacements="cell_spacing, cell_spacing, 1">
                    <Sphere radius="d/(2*l_n)" center="cell_spacing*3, cell_spacing*3, 0"/>
                </Arrangement>
            </InitCellObjects>
        </Population>
    </CellPopulations>
    <CPM>
        <Interaction default="0"/>
        <ShapeSurface scaling="none">
            <Neighborhood>
                <Order>2</Order>
            </Neighborhood>
        </ShapeSurface>
        <MonteCarloSampler stepper="edgelist">
            <MCSDuration value="0.1"/>
            <MetropolisKinetics temperature="0.2"/>
            <Neighborhood>
                <Order>2</Order>
            </Neighborhood>
        </MonteCarloSampler>
    </CPM>
</MorpheusModel>
